<!DOCTYPE html>
<html class="dark" lang="es">

<head>
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    <title>Advanced Agent Fusion Dashboard</title>
    <script src="https://cdn.tailwindcss.com?plugins=forms,typography,container-queries"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/dompurify@3.1.7/dist/purify.min.js"></script>
    <!-- Highlight.js for code syntax highlighting -->
    <link rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-dark.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <link rel="stylesheet" href="css/terminal.css">
    <link rel="stylesheet" href="css/main.css">
    <link rel="icon"
        href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><circle cx=%2250%22 cy=%2250%22 r=%2240%22 fill=%22%2300E0FF%22/></svg>">

    <link
        href="https://fonts.googleapis.com/css2?family=Encode+Sans:wght@300;400;500;600;700;800&family=IBM+Plex+Mono:wght@300;400;500;600;700&display=swap"
        rel="stylesheet" />
    <link
        href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&amp;display=swap"
        rel="stylesheet" />
    <link rel="stylesheet" href="responsive.css" />

    <script type="text/javascript" src="js/vis-network.min.js"></script>
    <style>
        #squad-network-container {
            width: 100%;
            height: 400px;
            /* Base height */
            background: #090909;
            border-radius: 0.5rem;
            border: 1px solid var(--border);
        }

        canvas {
            outline: none;
        }
    </style>
</head>

<body class="flex h-screen antialiased overflow-hidden">
    <!-- Left Sidebar: System Modules -->
    <aside class="w-[20%] h-full bg-[var(--sidebar-bg)] border-r border-[var(--border)] flex flex-col z-30"
        style="order: 1;">
        <!-- ... (contenido previo del sidebar izquierdo) ... -->
        <div class="p-8 pb-4">
            <h2 class="text-[10px] uppercase tracking-[0.3em] text-[var(--text-muted)] font-bold mb-10">System_Modules
            </h2>
        </div>
        <nav class="flex-grow overflow-y-auto hide-scrollbar">
            <div class="space-y-4 px-8">
                <div>
                    <a class="sidebar-item flex items-center gap-4 text-xs font-semibold uppercase tracking-widest text-[var(--accent-cyan)] glow-cyan mb-3"
                        href="#">
                        <span class="opacity-50">[1]</span> Active_Missions
                    </a>
                    <!-- Session List -->
                    <ul id="session-list"
                        class="space-y-2 pl-6 border-l border-[var(--border)] ml-2 transition-all duration-300">
                        <!-- Sessions will be injected here via JS -->
                    </ul>
                    <div class="mt-3 pl-6 ml-2">
                        <input id="session-search" type="text" placeholder="Buscar sesión..." aria-label="Buscar sesión"
                            class="w-full bg-transparent border border-[var(--border)] rounded px-2 py-1 text-[10px] text-[var(--text-main)] placeholder:text-[var(--text-muted)] focus:outline-none focus:border-[var(--accent-cyan)]" />
                        <button id="hidden-sessions-toggle" aria-expanded="false"
                            class="text-[9px] uppercase tracking-[0.2em] text-[var(--text-muted)] hover:text-[var(--accent-cyan)] transition-colors">
                            Ver sesiones ocultas
                        </button>
                        <div id="hidden-sessions-panel"
                            class="hidden mt-2 space-y-2 border-l border-dashed border-[var(--border)] pl-3">
                            <!-- Hidden sessions will be injected here -->
                        </div>
                        <button id="export-session-btn" aria-label="Exportar sesión actual"
                            class="mt-3 text-[9px] uppercase tracking-[0.2em] text-[var(--text-muted)] hover:text-[var(--accent-cyan)] transition-colors">
                            Exportar sesión actual
                        </button>
                        <button id="clear-chat-btn" aria-label="Limpiar vista del chat"
                            class="mt-2 text-[9px] uppercase tracking-[0.2em] text-[var(--text-muted)] hover:text-[var(--accent-orange)] transition-colors">
                            Limpiar vista del chat
                        </button>
                        <button id="reset-filters-btn" aria-label="Restablecer filtros"
                            class="mt-2 text-[9px] uppercase tracking-[0.2em] text-[var(--text-muted)] hover:text-[var(--accent-cyan)] transition-colors">
                            Restablecer filtros
                        </button>
                    </div>
                </div>
                <!-- ... (items de menú restantes) ... -->
                <a class="sidebar-item flex items-center gap-4 text-xs font-semibold uppercase tracking-widest text-[var(--text-muted)]"
                    href="#">
                    <span class="opacity-30">[2]</span> Task_Protocols
                </a>
                <a class="sidebar-item flex items-center gap-4 text-xs font-semibold uppercase tracking-widest text-[var(--text-muted)]"
                    href="#">
                    <span class="opacity-30">[3]</span> System_Tools
                </a>
                <a class="sidebar-item flex items-center gap-4 text-xs font-semibold uppercase tracking-widest text-[var(--text-muted)]"
                    href="#">
                    <span class="opacity-30">[4]</span> Core_Settings
                </a>
            </div>
        </nav>
        <div class="p-8 space-y-6">
            <div id="new-session-btn" role="button" tabindex="0" aria-label="Crear nueva sesión"
                class="border border-dashed border-[var(--border)] p-4 rounded-md cursor-pointer group hover:border-[var(--accent-cyan)] transition-colors">
                <div class="flex items-center justify-center gap-3">
                    <span
                        class="material-symbols-outlined text-sm text-[var(--text-muted)] group-hover:text-[var(--accent-cyan)]">add</span>
                    <span
                        class="text-[10px] uppercase tracking-[0.2em] font-bold text-[var(--text-muted)] group-hover:text-[var(--text-main)]">Ini_Session</span>
                </div>
            </div>
            <div class="text-[10px] text-center text-[var(--text-muted)] opacity-50 uppercase tracking-widest">
                Build v2.0.4 // Stable
            </div>
        </div>
    </aside>

    <!-- Main Content Area -->
    <div class="flex-grow flex flex-col h-full relative" style="background-color: var(--bg); order: 5;">
        <!-- ... (main content content) ... -->
        <!-- Sidebar Toggle Button -->
        <button id="sidebar-toggle" aria-label="Alternar barra lateral"
            class="absolute top-4 left-4 z-40 bg-[#111111] border border-[var(--border)] rounded-lg p-2 hover:border-[var(--accent-cyan)] transition-colors group sidebar-toggle-btn">
            <span
                class="material-symbols-outlined text-[20px] text-[var(--text-muted)] group-hover:text-[var(--accent-cyan)] transition-colors"
                id="toggle-icon">menu_open</span>
        </button>
        <main class="flex-grow flex flex-col max-w-[1024px] mx-auto w-full pt-12 pb-4 relative px-8"
            style="background-color: var(--bg);">
            <div id="chat-log" role="log" aria-live="polite" aria-relevant="additions" tabindex="0"
                class="flex-grow overflow-y-auto space-y-10 px-4 pb-10 min-h-0 custom-scrollbar"
                style="background-color: var(--bg);">
                <div class="text-[12px] text-[var(--text-muted)] mono leading-relaxed opacity-60">
                    Agent Zero v2.0 Online. Systems Nominal.<br />
                    Waiting for operator input...
                </div>

                <!-- Chat Area -->

            </div>
            <div class="mt-8 px-4 mb-6 shrink-0">
                <div
                    class="relative bg-[#0F0F0F] rounded-xl border border-[var(--border)] p-4 focus-within:border-[var(--accent-cyan)] transition-all duration-300 chat-input-shell">
                    <textarea id="message-input" aria-label="Escribe un mensaje"
                        class="w-full bg-transparent border-none focus:ring-0 text-[15px] font-normal text-[var(--text-main)] placeholder:text-[var(--text-muted)] opacity-60 focus:opacity-100 p-0 mono resize-none min-h-[48px]"
                        placeholder="Entra un commando o instruccion..."></textarea>
                    <div class="flex items-center justify-between mt-2 pt-2 border-t border-white/5">
                        <div class="flex gap-4 items-center">
                            <input type="file" id="file-input" class="hidden" accept=".pdf" />
                            <span id="upload-btn" role="button" aria-label="Subir PDF" tabindex="0"
                                class="material-symbols-outlined text-[18px] text-[var(--text-muted)] cursor-pointer hover:text-[var(--accent-cyan)] transition-colors"
                                title="Upload PDF to Knowledge Base">attach_file</span>
                            <span role="button" aria-label="Entrada de voz" tabindex="0"
                                class="material-symbols-outlined text-[18px] text-[var(--text-muted)] cursor-pointer hover:text-[var(--accent-cyan)]">mic</span>
                            <span id="char-counter"
                                class="text-[9px] uppercase tracking-[0.2em] text-[var(--text-muted)] opacity-60">
                                0/2000
                            </span>
                        </div>
                        <div class="flex items-center gap-2">
                            <button id="stop-btn" aria-label="Detener respuesta"
                                class="hidden bg-[#2A0F0F] hover:bg-[#3A1414] text-[10px] font-bold text-red-300 px-3 py-1.5 rounded uppercase tracking-widest flex items-center gap-2 border border-red-900/40 transition-colors"
                                title="Detener">
                                Stop <span class="material-symbols-outlined text-[14px]">stop_circle</span>
                            </button>
                            <button id="send-btn" aria-label="Enviar mensaje"
                                class="bg-[#1A1A1A] hover:bg-[#222222] text-[10px] font-bold text-[var(--text-main)] px-4 py-1.5 rounded uppercase tracking-widest flex items-center gap-2 border border-white/5 transition-colors send-btn">
                                Exec <span class="material-symbols-outlined text-[14px]">send</span>
                            </button>
                        </div>
                    </div>
                </div>
                <div class="mt-2 text-center">
                    <span class="text-[9px] uppercase tracking-[0.4em] text-[var(--text-muted)] opacity-40">Agent Zero
                        // Nexus Interface</span>
                </div>
            </div>
        </main>
        <!-- ... (footer) ... -->
        <footer
            class="h-10 border-t border-[var(--border)] bg-[#050505] flex items-center justify-between px-8 w-full shrink-0 main-footer">
            <div class="flex items-center gap-10">
                <div class="flex items-center gap-3">
                    <span
                        class="text-[9px] mono text-[var(--text-muted)] tracking-[0.2em] uppercase font-bold">Engine</span>
                    <span
                        class="text-[9px] mono text-[var(--text-main)] tracking-[0.2em] uppercase">Nexus-Alpha-X</span>
                </div>
                <div class="flex items-center gap-3">
                    <span
                        class="text-[9px] mono text-[var(--text-muted)] tracking-[0.2em] uppercase font-bold">Latency</span>
                    <span class="text-[9px] mono text-[var(--accent-cyan)] tracking-[0.2em] uppercase">08ms</span>
                </div>
                <div class="flex items-center gap-3">
                    <span
                        class="text-[9px] mono text-[var(--text-muted)] tracking-[0.2em] uppercase font-bold">Build</span>
                    <span class="text-[9px] mono text-[var(--text-main)] tracking-[0.2em] uppercase">v2.0.4
                        stable</span>
                </div>
            </div>
            <div class="flex items-center gap-4">
                <span id="system-status" role="status" aria-live="polite"
                    class="text-[9px] mono text-[var(--text-muted)] tracking-[0.2em] uppercase font-bold">System
                    Online</span>
                <div id="system-status-dot"
                    class="w-1.5 h-1.5 rounded-full bg-[var(--accent-cyan)] shadow-[0_0_8px_var(--accent-cyan)]"></div>
            </div>
        </footer>
    </div><!-- End Main Content Area -->

    <!-- Drag Handle -->
    <div id="drag-handle"
        class="w-1 hover:w-1.5 bg-[#222] hover:bg-[var(--accent-cyan)] cursor-col-resize transition-all duration-200 z-50 flex flex-col justify-center items-center group opacity-50 hover:opacity-100"
        style="order: 9;">
        <div class="h-8 w-0.5 bg-[var(--text-muted)] group-hover:bg-white rounded-full"></div>
    </div>

    <!-- Right Sidebar: Squad Intelligence -->
    <aside id="squad-sidebar"
        class="w-[20%] min-w-[250px] max-w-[50%] h-full bg-[var(--sidebar-bg)] border-l border-[var(--border)] flex flex-col z-30 transition-all duration-300"
        style="order: 10;">
        <div class="p-0 h-full flex flex-col">
            <!-- Sidebar Header / Tabs -->
            <div class="flex items-center border-b border-[var(--border)] bg-[#080808]">
                <button id="tab-squads"
                    class="flex-1 py-3 text-[9px] uppercase tracking-[0.15em] font-bold text-[var(--accent-purple)] border-b-2 border-[var(--accent-purple)] bg-[#111] transition-colors">
                    Squads
                </button>
                <button id="tab-activity"
                    class="flex-1 py-3 text-[9px] uppercase tracking-[0.15em] font-bold text-[var(--text-muted)] hover:text-[var(--text-main)] border-b-2 border-transparent transition-colors">
                    Live_Activity
                </button>
            </div>

            <div class="p-4 flex-grow flex flex-col overflow-hidden relative">
                <!-- PANEL: SQUADS -->
                <div id="panel-squads" class="flex flex-col h-full">
                    <h2
                        class="text-[10px] uppercase tracking-[0.3em] text-[var(--accent-purple)] font-bold mb-4 flex items-center gap-2 shrink-0 hidden">
                        <span class="material-symbols-outlined text-sm">groups</span> Squad_Intelligence
                    </h2>

                    <div class="flex items-center justify-between mb-4 shrink-0">
                        <div class="flex bg-[#111] rounded p-0.5 border border-[var(--border)]">
                            <button id="view-list-btn"
                                class="px-2 py-1 text-[8px] uppercase font-bold text-[var(--text-main)] bg-[var(--surface)] rounded shadow-sm transition-all">List</button>
                            <button id="view-graph-btn"
                                class="px-2 py-1 text-[8px] uppercase font-bold text-[var(--text-muted)] hover:text-[var(--text-main)] transition-colors">Graph</button>
                        </div>
                        <div class="flex items-center gap-2">
                            <span class="text-[8px] uppercase tracking-wider text-[var(--text-muted)] opacity-50">Show
                                All</span>
                            <label class="squad-toggle">
                                <input id="squad-show-all" type="checkbox" aria-label="Mostrar todos los squads" />
                                <span class="squad-toggle-slider"></span>
                            </label>
                        </div>
                    </div>

                    <div id="squad-status-container" class="space-y-4 overflow-y-auto hide-scrollbar flex-grow"
                        aria-live="polite">
                        <div class="text-[10px] text-[var(--text-muted)] italic mono">
                            Escaneando escuadrones activos...
                        </div>
                    </div>

                    <!-- Network Graph Container (Hidden by default) -->
                    <div id="squad-network-container"
                        class="hidden flex-grow w-full border border-[var(--border)] rounded-lg bg-[#080808] relative overflow-hidden mb-4">
                        <div
                            class="absolute top-2 left-2 text-[8px] mono text-[var(--text-muted)] z-10 bg-black/50 px-1 rounded">
                            LIVE NET</div>

                        <!-- Legend Overlay -->
                        <div
                            class="absolute bottom-2 right-2 z-10 bg-[#050505]/80 backdrop-blur-md border border-white/5 p-2 rounded flex flex-col gap-1.5 shadow-xl">
                            <div class="flex items-center gap-2">
                                <div
                                    class="w-2 h-2 rounded-sm rotate-45 border border-[var(--accent-cyan)] shadow-[0_0_5px_var(--accent-cyan)]">
                                </div>
                                <span class="text-[8px] mono text-white/70 uppercase tracking-tighter">Nexus Core</span>
                            </div>
                            <div class="flex items-center gap-2">
                                <div class="w-1.5 h-1.5 rounded-full bg-[var(--accent-purple)]"></div>
                                <span class="text-[8px] mono text-white/70 uppercase tracking-tighter">Squad Hub</span>
                            </div>
                            <div class="flex items-center gap-2">
                                <div
                                    class="w-1.5 h-1.5 rounded-full bg-[var(--accent-cyan)] shadow-[0_0_5px_var(--accent-cyan)]">
                                </div>
                                <span class="text-[8px] mono text-white/70 uppercase tracking-tighter">Agent
                                    Active</span>
                            </div>
                            <div class="flex items-center gap-2">
                                <div class="w-1.5 h-1.5 rounded-full bg-[#333]"></div>
                                <span class="text-[8px] mono text-white/70 uppercase tracking-tighter">Agent Idle</span>
                            </div>
                        </div>
                    </div>

                </div> <!-- End Panel Squads -->

                <!-- PANEL: ACTIVITY LOG -->
                <div id="panel-activity" class="hidden flex-col h-full relative">
                    <div class="flex items-center justify-between mb-2 shrink-0">
                        <span
                            class="text-[9px] uppercase tracking-widest text-[var(--text-muted)]">Terminal_Output</span>
                        <button id="clear-logs-btn"
                            class="text-[9px] text-[var(--text-muted)] hover:text-[var(--text-main)] uppercase tracking-wider">Clear</button>
                    </div>
                    <div id="activity-log-container"
                        class="flex-grow overflow-y-auto custom-scrollbar font-mono text-[10px] space-y-2 pb-4">
                        <div class="text-[var(--text-muted)] italic opacity-50 p-2">Waiting for execution events...
                        </div>
                    </div>
                </div>
            </div> <!-- End relative flex container -->
            <div class="mt-auto p-4 border-t border-[var(--border)] bg-[#0A0A0A] squad-footer shrink-0">
                <div
                    class="flex items-center justify-between text-[9px] uppercase tracking-widest text-[var(--text-muted)]">
                    <span>Network_Sync</span>
                    <span id="sync-status" class="text-[var(--accent-cyan)]">Live</span>
                </div>
            </div>
    </aside>

    <!-- Floating Buttons (Absolute/Fixed) -->
    <button id="scroll-to-latest" class="scroll-to-latest hidden" aria-label="Ir al final del chat" title="Ir al final">
        <span class="material-symbols-outlined text-[14px]">south</span>
        Ver lo nuevo
    </button>

    <button class="theme-toggle" id="theme-toggle" aria-label="Alternar tema" title="Cambiar tema">
        <svg id="theme-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
            stroke-linecap="round" stroke-linejoin="round">
            <circle cx="12" cy="12" r="5"></circle>
            <line x1="12" y1="1" x2="12" y2="3"></line>
            <line x1="12" y1="21" x2="12" y2="23"></line>
            <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
            <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
            <line x1="1" y1="12" x2="3" y2="12"></line>
            <line x1="21" y1="12" x2="23" y2="12"></line>
            <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
            <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
        </svg>
    </button>

    <!-- Scripts (Moved to end) -->
    <script type="module" src="js/ui.js"></script>
    <script defer src="js/progress.js"></script>
    <script defer src="js/terminal.js"></script>
    <script defer src="js/terminal-integration.js"></script>
    <script defer src="js/theme-switcher.js"></script>
    <script type="module" src="js/squad-status.js"></script>
    <script type="module" src="js/main.js"></script>

    <!-- Dialogs -->
    <dialog id="prompt-dialog" class="dialog-backdrop">
        <form method="dialog" class="dialog-shell">
            <h3 id="prompt-title" class="text-[12px] font-bold uppercase tracking-widest mb-3">Renombrar sesión</h3>
            <label for="prompt-input"
                class="text-[10px] text-[var(--text-muted)] uppercase tracking-wider">Nombre</label>
            <input id="prompt-input" type="text" autocomplete="off" />
            <div class="dialog-actions">
                <button id="prompt-cancel" class="dialog-btn" value="cancel">Cancelar</button>
                <button id="prompt-confirm" class="dialog-btn primary" value="confirm">Guardar</button>
            </div>
        </form>
    </dialog>

    <dialog id="confirm-dialog" class="dialog-backdrop">
        <form method="dialog" class="dialog-shell">
            <h3 id="confirm-title" class="text-[12px] font-bold uppercase tracking-widest mb-3">Confirmar</h3>
            <p id="confirm-message" class="text-[11px] text-[var(--text-muted)] leading-relaxed"></p>
            <div class="dialog-actions">
                <button id="confirm-cancel" class="dialog-btn" value="cancel">Cancelar</button>
                <button id="confirm-ok" class="dialog-btn primary" value="confirm">Aceptar</button>
            </div>
        </form>
    </dialog>

</body>

</html>